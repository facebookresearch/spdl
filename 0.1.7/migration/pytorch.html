<!doctype html>
<html class="no-js" lang="en" data-content_root="../">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="Index" href="../genindex.html" /><link rel="search" title="Search" href="../search.html" /><link rel="next" title="Best Practices" href="../best_practice.html" /><link rel="prev" title="Paradigm Shift" href="paradigm_shift.html" />

    <!-- Generated with Sphinx 7.4.7 and Furo 2024.07.18 -->
        <title>Migrating from PyTorch DataLoader - SPDL 0.1.7 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=8f2a1f02" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css?v=613ab9ff" />
    <link rel="stylesheet" type="text/css" href="../_static/collapsible-lists/css/tree_view.css?v=a885cde7" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css?v=302659d7" />
    <link rel="stylesheet" type="text/css" href="../_static/css/custom.css?v=a8e03d5d" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-SNXS50Q2E3"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-SNXS50Q2E3');
</script>
</head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">SPDL 0.1.7 documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../index.html">
  
  
  <span class="sidebar-brand-text">SPDL 0.1.7 documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul>
<li class="toctree-l1"><a class="reference internal" href="../index.html">Home</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../getting_started/index.html">Getting Started</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of Getting Started</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../getting_started/intro.html">Building and Running Pipeline</a></li>
<li class="toctree-l2"><a class="reference internal" href="../getting_started/stages.html">Pipeline Stages</a></li>
<li class="toctree-l2"><a class="reference internal" href="../getting_started/concurrency.html">Concurrency</a></li>
<li class="toctree-l2"><a class="reference internal" href="../getting_started/parallelism.html">Pipeline Parallelism</a></li>
<li class="toctree-l2"><a class="reference internal" href="../getting_started/logging.html">Collecting Runtime Statistics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../getting_started/pytorch.html">Building High-Performance DataLoaders</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../async/index.html">Introduction to Async I/O</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle navigation of Introduction to Async I/O</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../async/problem.html">Implementing an Orchestration Mechanism</a></li>
<li class="toctree-l2"><a class="reference internal" href="../async/event_loop.html">The Event Loop</a></li>
<li class="toctree-l2"><a class="reference internal" href="../async/unit.html">The <code class="docutils literal notranslate"><span class="pre">async</span></code> and <code class="docutils literal notranslate"><span class="pre">await</span></code> keywords</a></li>
<li class="toctree-l2"><a class="reference internal" href="../async/sync.html">Running Synchronous Functions</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../io/index.html">IO Module</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle navigation of IO Module</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../io/basic.html">High-Level Loading Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../io/decoding_overview.html">Decoding Process Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../io/packets_frames_concepts.html">Packets and Frames</a></li>
<li class="toctree-l2"><a class="reference internal" href="../io/filtering.html">Filter Graphs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../io/advanced_filtering.html">Advanced Filter Graphs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../io/streaming_decoding.html">Streaming Decoding</a></li>
<li class="toctree-l2"><a class="reference internal" href="../io/gpu_decoding.html">Hardware-Accelerated Video Decoding</a></li>
<li class="toctree-l2"><a class="reference internal" href="../io/numpy_arrays.html">Loading NumPy Arrays</a></li>
<li class="toctree-l2"><a class="reference internal" href="../io/encoding.html">Media Encoding</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../optimization_guide/index.html">Optimization Guide</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle navigation of Optimization Guide</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../optimization_guide/headspace_analysis.html">Headspace Analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../optimization_guide/noisy_neighbour.html">Noisy Neighbour</a></li>
<li class="toctree-l2"><a class="reference internal" href="../optimization_guide/setup.html">Composition of Pipeline</a></li>
<li class="toctree-l2"><a class="reference internal" href="../optimization_guide/analysis.html">Analyzing the Performance</a></li>
<li class="toctree-l2"><a class="reference internal" href="../optimization_guide/stats.html">Understanding the performance statistics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../optimization_guide/fleet_metrics.html">Metrics across Ranks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../optimization_guide/straggler.html">The Straggler</a></li>
<li class="toctree-l2"><a class="reference internal" href="../optimization_guide/resolution.html">Resolving the Bottleneck</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../case_studies/index.html">Case Studies</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"/><label for="toctree-checkbox-5"><div class="visually-hidden">Toggle navigation of Case Studies</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../case_studies/parallelism.html">Parallelism and Performance</a></li>
<li class="toctree-l2"><a class="reference internal" href="../case_studies/data_format.html">Data Format and Performance</a></li>
<li class="toctree-l2"><a class="reference internal" href="../case_studies/inference.html">Building Inference Pipeline</a></li>
</ul>
</li>
<li class="toctree-l1 current has-children"><a class="reference internal" href="index.html">Migration Guide</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" role="switch" type="checkbox"/><label for="toctree-checkbox-6"><div class="visually-hidden">Toggle navigation of Migration Guide</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="why.html">Why migrate to SPDL?</a></li>
<li class="toctree-l2"><a class="reference internal" href="paradigm_shift.html">Paradigm Shift</a></li>
<li class="toctree-l2 current current-page"><a class="current reference internal" href="#">Migrating from PyTorch DataLoader</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../best_practice.html">Best Practices</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../examples.html">Examples</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" role="switch" type="checkbox"/><label for="toctree-checkbox-7"><div class="visually-hidden">Toggle navigation of Examples</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../generated/image_dataloading.html">Image dataloading</a></li>
<li class="toctree-l2"><a class="reference internal" href="../generated/video_dataloading.html">Video dataloading</a></li>
<li class="toctree-l2"><a class="reference internal" href="../generated/imagenet_classification.html">Imagenet classification</a></li>
<li class="toctree-l2"><a class="reference internal" href="../generated/multi_thread_preprocessing.html">Multi thread preprocessing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../generated/streaming_nvdec_decoding.html">Streaming nvdec decoding</a></li>
<li class="toctree-l2"><a class="reference internal" href="../generated/streaming_video_processing.html">Streaming video processing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../generated/performance_analysis.html">Performance analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../generated/performance_simulation.html">Performance simulation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../generated/hydra_integration.html">Hydra integration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../generated/pipeline_definitions.html">Pipeline definitions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../generated/pipeline_profiling.html">Pipeline profiling</a></li>
<li class="toctree-l2"><a class="reference internal" href="../generated/benchmark_utils.html">Benchmark utils</a></li>
<li class="toctree-l2"><a class="reference internal" href="../generated/benchmark_numpy.html">Benchmark numpy</a></li>
<li class="toctree-l2"><a class="reference internal" href="../generated/benchmark_wav.html">Benchmark wav</a></li>
<li class="toctree-l2"><a class="reference internal" href="../generated/benchmark_tarfile.html">Benchmark tarfile</a></li>
<li class="toctree-l2"><a class="reference internal" href="../generated/benchmark_video.html">Benchmark video</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../faq.html">Frequently Asked Questions</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API References</span></p>
<ul>
<li class="toctree-l1 has-children"><a class="reference internal" href="../api.html">API Reference</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" role="switch" type="checkbox"/><label for="toctree-checkbox-8"><div class="visually-hidden">Toggle navigation of API Reference</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../generated/spdl.pipeline.html">spdl.pipeline</a></li>
<li class="toctree-l2"><a class="reference internal" href="../generated/spdl.pipeline.defs.html">spdl.pipeline.defs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../generated/spdl.pipeline.config.html">spdl.pipeline.config</a></li>
<li class="toctree-l2"><a class="reference internal" href="../generated/spdl.dataloader.html">spdl.dataloader</a></li>
<li class="toctree-l2"><a class="reference internal" href="../generated/spdl.source.html">spdl.source</a></li>
<li class="toctree-l2"><a class="reference internal" href="../generated/spdl.io.html">spdl.io</a></li>
<li class="toctree-l2"><a class="reference internal" href="../generated/spdl.io.utils.html">spdl.io.utils</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../cpp.html">API Reference (C++)</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" role="switch" type="checkbox"/><label for="toctree-checkbox-9"><div class="visually-hidden">Toggle navigation of API Reference (C++)</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../generated/libspdl/libspdl_class.html">Class List</a></li>
<li class="toctree-l2"><a class="reference internal" href="../generated/libspdl/libspdl_file.html">File List</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../generated/libspdl/libspdl_api.html">API</a><input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" role="switch" type="checkbox"/><label for="toctree-checkbox-10"><div class="visually-hidden">Toggle navigation of API</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/namespace_spdl.html">Namespace spdl</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/namespace_spdl__core.html">Namespace spdl::core</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/namespace_spdl__core__detail.html">Namespace spdl::core::detail</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/namespace_std.html">Namespace std</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/structAVRational.html">Struct AVRational</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/structspdl_1_1core_1_1BytesAdaptor.html">Struct BytesAdaptor</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/structspdl_1_1core_1_1CPUBuffer.html">Struct CPUBuffer</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/structspdl_1_1core_1_1DataInterface.html">Struct DataInterface</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/structspdl_1_1core_1_1DecodeConfig.html">Struct DecodeConfig</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/structspdl_1_1core_1_1DemuxConfig.html">Struct DemuxConfig</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/structspdl_1_1core_1_1EncodeConfigBase.html">Template Struct EncodeConfigBase</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/structspdl_1_1core_1_1Generator.html">Template Struct Generator</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/structspdl_1_1core_1_1Generator_1_1promise__type.html">Struct Generator::promise_type</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/structspdl_1_1core_1_1Packets.html">Template Struct Packets</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/structspdl_1_1core_1_1RawPacketData.html">Struct RawPacketData</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/structspdl_1_1core_1_1SourceAdaptor.html">Struct SourceAdaptor</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/structspdl_1_1core_1_1Storage.html">Struct Storage</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/classspdl_1_1core_1_1BSF.html">Template Class BSF</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/classspdl_1_1core_1_1Codec.html">Template Class Codec</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/classspdl_1_1core_1_1CPUStorage.html">Class CPUStorage</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/classspdl_1_1core_1_1Decoder.html">Template Class Decoder</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/classspdl_1_1core_1_1Demuxer.html">Class Demuxer</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/classspdl_1_1core_1_1detail_1_1DecoderImpl.html">Template Class DecoderImpl</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/classspdl_1_1core_1_1detail_1_1EncoderImpl.html">Template Class EncoderImpl</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/classspdl_1_1core_1_1Encoder.html">Template Class Encoder</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/classspdl_1_1core_1_1FilterGraph.html">Class FilterGraph</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/classspdl_1_1core_1_1Frames.html">Template Class Frames</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/classspdl_1_1core_1_1InternalError.html">Class InternalError</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/classspdl_1_1core_1_1Muxer.html">Class Muxer</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/classspdl_1_1core_1_1PacketSeries.html">Class PacketSeries</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/classspdl_1_1core_1_1StreamingDemuxer.html">Class StreamingDemuxer</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/classspdl_1_1core_1_1TracingSession.html">Class TracingSession</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/enum_types_8h_1a5422694500d2203e301dc182e5f63d22.html">Enum CodecID</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/enum_types_8h_1adb4e1adb2b3a59148c2797f903ead06f.html">Enum ElemClass</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/enum_types_8h_1ac22438cfd069f0b1b6a736e73e8d244c.html">Enum MediaType</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/function_frames_8h_1a30fbfab5f9ecfb208928ebdaca7f4349.html">Template Function spdl::core::clone</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/function_conversion_8h_1a3f08ca7a5c09ab82603e239e50dff4d7.html">Template Function spdl::core::convert_frames(const std::vector&lt;const Frames&lt;media&gt; *&gt;&amp;, std::shared_ptr&lt;CPUStorage&gt;)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/function_conversion_8h_1ae55bfac2f391205603d77241fc25ca1a.html">Template Function spdl::core::convert_frames(const Frames&lt;media&gt; *, std::shared_ptr&lt;CPUStorage&gt;)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/function_buffer_8h_1abb668d9a68635211e5e07bd5038df4aa.html">Function spdl::core::cpu_buffer</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/function_conversion_8h_1a295b42ad20d2569806d9a15009a44ca8.html">Function spdl::core::create_reference_audio_frame</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/function_conversion_8h_1a87d61e0429716c42f3a5f5e85aad5b61.html">Function spdl::core::create_reference_video_frame</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/function_packets_8h_1ad3bdea22ad439f82174ce27c26bec857.html">Function spdl::core::extract_packets_at_indices</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/function_utils_8h_1a0aef7b410dcb4075e477b10ba3e71f80.html">Function spdl::core::get_ffmpeg_filters</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/function_utils_8h_1ae1a3d30b33d837c39c40190e681d37c8.html">Function spdl::core::get_ffmpeg_log_level</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/function_utils_8h_1a0ebae69b46f68552c3f64ddc2af67f53.html">Function spdl::core::get_ffmpeg_versions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/function_packets_8h_1a50ec9c8a7e6ab71e7827df2eb862dc40.html">Template Function spdl::core::get_timestamps</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/function_utils_8h_1af82c781c7484afbad6cbac32ff925793.html">Function spdl::core::init_glog</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/function_utils_8h_1abbebef003881d8734c12e03a47814732.html">Function spdl::core::init_tracing</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/function_rational__utils_8h_1ad2261ff34cb13e16d886d6629ccc7ff7.html">Function spdl::core::is_within_window</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/function_demuxing_8h_1ad3fdb02bd04d231cd7238e034c27711f.html">Function spdl::core::make_demuxer(const std::string&amp;, const SourceAdaptorPtr&amp;, const std::optional&lt;DemuxConfig&gt;&amp;)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/function_demuxing_8h_1a590baa95f8eeb6bc0092c723ff060dd4.html">Function spdl::core::make_demuxer(const std::string_view, const std::optional&lt;DemuxConfig&gt;&amp;)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/function_filter__graph_8h_1aaa3dba3ab905bd429d038f0bbaa6ce16.html">Function spdl::core::make_filter_graph</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/function_rational__utils_8h_1a471d41ab59aa4991181e401a18e23a74.html">Function spdl::core::make_rational</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/function_utils_8h_1aa1e91130e5d71e8c2a104e4f72296ff3.html">Function spdl::core::register_avdevices</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/function_utils_8h_1a9b6c16227a1a8445319b487cacb0cd1d.html">Function spdl::core::set_ffmpeg_log_level</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/function_rational__utils_8h_1a14aa39c30ba418319ac13a94fea74420.html">Function spdl::core::to_double</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/function_rational__utils_8h_1a7a439114de303090f89dcc44f8c62d6d.html">Function spdl::core::to_rational</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/function_utils_8h_1a893d39670b4169063d8f6e3723f4bc11.html">Template Function spdl::core::trace_counter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/function_utils_8h_1ae27a1cc3e5bfd9997090eb40711cc6c6.html">Function spdl::core::trace_event_begin</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/function_utils_8h_1a8f29c25b417b77e9dfb5a769b418c169.html">Function spdl::core::trace_event_end</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/define_frames_8h_1ac2ad95ac922a100ec27340436eb94940.html">Define _IS_AUDIO</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/define_frames_8h_1ac99c83df576500933a3691deb137be6d.html">Define _IS_IMAGE</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/define_frames_8h_1a9beaa64113e413112d43491ba5c13670.html">Define _IS_VIDEO</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/define_types_8h_1a3a6c4d7f842d451acf8717ce734385f2.html">Define SPDL_DEFAULT_BUFFER_SIZE</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/typedef_types_8h_1a6eff035c271caa5a533987a1e00ad43e.html">Typedef AVRational</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/typedef_frames_8h_1aba3a9982b74abb6be181dc4d247d53fa.html">Typedef spdl::core::AnyFrames</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/typedef_packets_8h_1ab96da01bb9cc9793e8ae2637e1dd610b.html">Typedef spdl::core::AnyPackets</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/typedef_codec_8h_1a9098e05b01da4afd02090b0d6d7624ba.html">Typedef spdl::core::AudioCodec</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/typedef_types_8h_1a23b168da4cdf96923387b92a43f20038.html">Typedef spdl::core::AudioEncodeConfig</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/typedef_encoder_8h_1a57216492ce017017647dba9d1f6f2a5d.html">Typedef spdl::core::AudioEncoder</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/typedef_encoder_8h_1a0dfcc06d4bbea67c7f45399be8719fa6.html">Typedef spdl::core::AudioEncoderPtr</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/typedef_frames_8h_1a5be56dffe8f2b76de9540fb1ad8b83bf.html">Typedef spdl::core::AudioFrames</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/typedef_frames_8h_1a9db8234daca15eb073d00fa762641b62.html">Typedef spdl::core::AudioFramesPtr</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/typedef_packets_8h_1a9644f8aa13f0e4db02d8ab60673563a3.html">Typedef spdl::core::AudioPackets</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/typedef_packets_8h_1ab2cc72fb6b931466960bd4b9f812784c.html">Typedef spdl::core::AudioPacketsPtr</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/typedef_buffer_8h_1ab6e5b43497adbd35e9fbc35cf5be7101.html">Typedef spdl::core::CPUBufferPtr</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/typedef_adaptor_8h_1adcb670a31326eb24268b384396736cd6.html">Typedef spdl::core::DataInterfacePtr</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/typedef_decoder_8h_1a4b0502ea20d1dda958a67deeb582a74b.html">Typedef spdl::core::DecoderPtr</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/typedef_demuxing_8h_1a4b53016f9b756cc2c2cfbd0e5ad9558b.html">Typedef spdl::core::DemuxerPtr</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/typedef_encoder_8h_1aacfba556b86e2d663a004b8677567339.html">Typedef spdl::core::EncoderPtr</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/typedef_filter__graph_8h_1a29554b40f89e4b227521ff86ccf69b8b.html">Typedef spdl::core::FilterGraphPtr</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/typedef_frames_8h_1ad628496b3863230dd76eeccc4fa66437.html">Typedef spdl::core::FramesPtr</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/typedef_codec_8h_1a606d432c7b033a787f653c4992937e6f.html">Typedef spdl::core::ImageCodec</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/typedef_frames_8h_1a53a3c93ef56a4400fabd3a553ab21c4a.html">Typedef spdl::core::ImageFrames</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/typedef_frames_8h_1a3760130bba382ba7f15df177ca3374c7.html">Typedef spdl::core::ImageFramesPtr</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/typedef_packets_8h_1af018ade1cd38831c342686abbcb787a8.html">Typedef spdl::core::ImagePackets</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/typedef_packets_8h_1a8b9c8b08fcbf891fa939700ecd807ce1.html">Typedef spdl::core::ImagePacketsPtr</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/typedef_muxer_8h_1aaa76352d246819df02bc407729f69dda.html">Typedef spdl::core::MuxerPtr</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/typedef_types_8h_1aa5d8175da6bbcbe93e7191461f7baa20.html">Typedef spdl::core::OptionDict</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/typedef_packets_8h_1a331b599d0eceb00ebef166d64623c71a.html">Typedef spdl::core::PacketSeriesPtr</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/typedef_packets_8h_1aad5761fe07714efccc2be969a4397354.html">Typedef spdl::core::PacketsPtr</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/typedef_types_8h_1a8bd80c8465b1f3e17b564c5ced977a2d.html">Typedef spdl::core::Rational</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/typedef_adaptor_8h_1adfe58c3c3a3d3171c1d69c2e9924f2a7.html">Typedef spdl::core::SourceAdaptorPtr</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/typedef_demuxing_8h_1a0a7f8c140cd7110dc5f3f6537fae67db.html">Typedef spdl::core::StreamingDemuxerPtr</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/typedef_types_8h_1a49247f362e405e358b40d1de70d44a27.html">Typedef spdl::core::TimeWindow</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/typedef_codec_8h_1ac7441badce2b2aa467eac09b35d4f81e.html">Typedef spdl::core::VideoCodec</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/typedef_types_8h_1a8b310bdb98714a971b07aa58f7403529.html">Typedef spdl::core::VideoEncodeConfig</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/typedef_encoder_8h_1a383bf2b0ac1564702f10e3b5f3ef03f6.html">Typedef spdl::core::VideoEncoder</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/typedef_encoder_8h_1a39ace4ea741767fa3d802040a9bc22e1.html">Typedef spdl::core::VideoEncoderPtr</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/typedef_frames_8h_1af1892953097f3723455403752ef79fc5.html">Typedef spdl::core::VideoFrames</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/typedef_frames_8h_1acb0efeb222082bf955c71c74964d301d.html">Typedef spdl::core::VideoFramesPtr</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/typedef_packets_8h_1a7be7c9faccc623d12fb33ec966f84b4c.html">Typedef spdl::core::VideoPackets</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/typedef_packets_8h_1aa21b44d594bfc132b4252fd2f544a691.html">Typedef spdl::core::VideoPacketsPtr</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../genindex.html">API Index</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Development Notes</span></p>
<ul>
<li class="toctree-l1 has-children"><a class="reference internal" href="../notes/index.html">Development Notes</a><input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" role="switch" type="checkbox"/><label for="toctree-checkbox-11"><div class="visually-hidden">Toggle navigation of Development Notes</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../notes/pipeline_impl.html">Implementation detail of Pipeline</a></li>
<li class="toctree-l2"><a class="reference internal" href="../notes/remote_iterable_protocol.html">Remote Iterable Protocol</a></li>
<li class="toctree-l2"><a class="reference internal" href="../notes/pytorch_cuda_race_condition.html">PyTorch CUDA Race Condition in Multi-threading</a></li>
</ul>
</li>
</ul>

</div>
</div>
<div class="sidebar-tree">
<ul>
  <li class="toctree-l1 has-children">
    <span class="reference">Versions</span>
    <input class="toctree-checkbox" id="toctree-checkbox-versions" name="toctree-checkbox-versions" role="switch" type="checkbox">
    <label for="toctree-checkbox-versions">
      <div class="visually-hidden">Toggle navigattion of Versions</div>
      <i class="icon">
        <svg>
          <use href="#svg-arrow-right"></use>
        </svg>
      </i>
    </label>
    <ul>
      <li class="toctree-l2"><a class="reference internal" href="/spdl/main">dev</a></li>
      <li class="toctree-l2"><a class="reference internal" href="/spdl/latest">latest-release</a></li>
      <li class="toctree-l2"><a class="reference internal" href="/spdl/0.1.7">0.1.7</a></li>
      <li class="toctree-l2"><a class="reference internal" href="/spdl/0.1.6">0.1.6</a></li>
      <li class="toctree-l2"><a class="reference internal" href="/spdl/0.1.5">0.1.5</a></li>
      <li class="toctree-l2"><a class="reference internal" href="/spdl/0.1.4">0.1.4</a></li>
      <li class="toctree-l2"><a class="reference internal" href="/spdl/0.1.3">0.1.3</a></li>
      <li class="toctree-l2"><a class="reference internal" href="/spdl/0.1.2">0.1.2</a></li>
      <li class="toctree-l2"><a class="reference internal" href="/spdl/0.1.1">0.1.1</a></li>
      <li class="toctree-l2"><a class="reference internal" href="/spdl/0.1.0">0.1.0</a></li>
      <li class="toctree-l2"><a class="reference internal" href="/spdl/0.0.14">0.0.14</a></li>
      <li class="toctree-l2"><a class="reference internal" href="/spdl/0.0.13">0.0.13</a></li>
      <li class="toctree-l2"><a class="reference internal" href="/spdl/0.0.12">0.0.12</a></li>
      <li class="toctree-l2"><a class="reference internal" href="/spdl/0.0.11">0.0.11</a></li>
      <li class="toctree-l2"><a class="reference internal" href="/spdl/0.0.10">0.0.10</a></li>
      <li class="toctree-l2"><a class="reference internal" href="/spdl/0.0.9">0.0.9</a></li>
      <li class="toctree-l2"><a class="reference internal" href="/spdl/0.0.8">0.0.8</a></li>
    </ul>
  </li>
</ul>
</div>
      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="view-this-page">
  <a class="muted-link" href="../_sources/migration/pytorch.rst.txt" title="View this page">
    <svg><use href="#svg-eye"></use></svg>
    <span class="visually-hidden">View this page</span>
  </a>
</div>
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <section id="migrating-from-pytorch-dataloader">
<h1>Migrating from PyTorch DataLoader<a class="headerlink" href="#migrating-from-pytorch-dataloader" title="Link to this heading">¶</a></h1>
<p>If you are using <a class="reference external" href="https://docs.pytorch.org/docs/stable/data.html#torch.utils.data.DataLoader" title="(in PyTorch v2.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">torch.utils.data.DataLoader</span></code></a> and decided to
migrate to SPDL, there are couple of conceptual differences
you want to be aware of.</p>
<p>There are three distinguished components in PyTorch’s DataLoader.</p>
<ol class="arabic simple">
<li><p>Sampler - Generates keys.</p></li>
<li><p>Dataset - Map an input key to a Tensor.</p></li>
<li><p>Collate function - Merge multiple Tensors into one batch Tensor.</p></li>
</ol>
<p>One notable thing about this composition is that dataset contains the logic
to convert the data source to Tensor, and it directly maps keys to Tensors.
It prohibits the access to the data source or data itself, and it does not
distinguish the steps for data acquisition, decoding and pre-processing nor
expose them.</p>
<p>So as to achieve high throughput, it is important to separate the operations of
different natures and configure them, but there is no native support for
that in <a class="reference external" href="https://docs.pytorch.org/docs/stable/data.html#torch.utils.data.Dataset" title="(in PyTorch v2.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">torch.utils.data.Dataset</span></code></a>.</p>
<p>Now let’s look into a task of image loading for classification task, using
TorchVision’s <a class="reference external" href="https://docs.pytorch.org/vision/stable/generated/torchvision.datasets.ImageNet.html#torchvision.datasets.ImageNet" title="(in Torchvision v0.24)"><code class="xref py py-class docutils literal notranslate"><span class="pre">torchvision.datasets.ImageNet</span></code></a>.</p>
<p>Here is the base dataset instance we are going to use.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">torchvision.datasets</span><span class="w"> </span><span class="kn">import</span> <span class="n">ImageNet</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">torchvision.transforms</span><span class="w"> </span><span class="kn">import</span> <span class="n">Compose</span><span class="p">,</span> <span class="n">PILToTensor</span><span class="p">,</span> <span class="n">Resize</span>

<span class="n">dataset</span> <span class="o">=</span> <span class="n">ImageNet</span><span class="p">(</span>
    <span class="s2">&quot;dataset_directory&quot;</span><span class="p">,</span>
    <span class="n">transform</span><span class="o">=</span><span class="n">Compose</span><span class="p">([</span><span class="n">Resize</span><span class="p">((</span><span class="mi">224</span><span class="p">,</span> <span class="mi">224</span><span class="p">)),</span> <span class="n">PILToTensor</span><span class="p">()]),</span>
<span class="p">)</span>
</pre></div>
</div>
<p>The images are decoded in
<code class="xref py py-class docutils literal notranslate"><span class="pre">torchvision.datasets.ImageNet.__getitem__</span></code> method, then
resized and converted to Tensor through <a class="reference external" href="https://docs.pytorch.org/vision/stable/generated/torchvision.transforms.Resize.html#torchvision.transforms.Resize" title="(in Torchvision v0.24)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Resize</span></code></a>
and <a class="reference external" href="https://docs.pytorch.org/vision/stable/generated/torchvision.transforms.PILToTensor.html#torchvision.transforms.PILToTensor" title="(in Torchvision v0.24)"><code class="xref py py-class docutils literal notranslate"><span class="pre">PILToTensor</span></code></a> transforms.</p>
<section id="decoding-images-in-threads">
<h2>Decoding images in threads<a class="headerlink" href="#decoding-images-in-threads" title="Link to this heading">¶</a></h2>
<p>When adopting SPDL before free-threaded (a.k.a no-GIL) Python becomes available
and stable, we need to check whether the dataset instance can be used
in threaded environment in a performant manner.</p>
<ul class="simple">
<li><p>Does the internal loading logic release GIL?</p></li>
<li><p>Is the dataset instance thread-safe?</p></li>
</ul>
<p>If the answer to both questions is yes, then we can start by reusing
the dataset logic as-is in <code class="xref py py-class docutils literal notranslate"><span class="pre">spdl.dataloader.Pipeline</span></code>.</p>
<p>TorchVision’s dataset implementations meet these requirements.
By default, TorchVision uses Pillow to load images, and
Pillow releases GIL. The dataset is thread-safe.</p>
<p>The following code snippets show how one can use PyTorch
<a class="reference external" href="https://docs.pytorch.org/docs/stable/data.html#torch.utils.data.DataLoader" title="(in PyTorch v2.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">DataLoader</span></code></a> to load images without batching.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">torch</span>

<span class="n">dataloader</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">DataLoader</span><span class="p">(</span>
    <span class="n">dataset</span><span class="p">,</span>
    <span class="n">batch_size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">num_workers</span><span class="o">=</span><span class="n">num_workers</span><span class="p">,</span>
<span class="p">)</span>

<span class="k">for</span> <span class="n">batch</span><span class="p">,</span> <span class="n">classes</span> <span class="ow">in</span> <span class="n">dataloader</span><span class="p">:</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>The following is an equivalent implementation using SPDL
<code class="xref py py-class docutils literal notranslate"><span class="pre">Pipeline</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">spdl.dataloader</span><span class="w"> </span><span class="kn">import</span> <span class="n">PipelineBuilder</span>

<span class="n">pipeline</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">PipelineBuilder</span><span class="p">()</span>
    <span class="o">.</span><span class="n">add_source</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dataset</span><span class="p">)))</span>
    <span class="o">.</span><span class="n">pipe</span><span class="p">(</span>
        <span class="n">dataset</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">,</span>
        <span class="n">concurrency</span><span class="o">=</span><span class="n">num_workers</span><span class="p">,</span>
        <span class="n">output_order</span><span class="o">=</span><span class="s2">&quot;input&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="o">.</span><span class="n">add_sink</span><span class="p">(</span><span class="n">prefetch_factor</span><span class="p">)</span>
    <span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="n">num_threads</span><span class="o">=</span><span class="n">num_workers</span><span class="p">)</span>
<span class="p">)</span>

<span class="k">with</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">auto_stop</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">batch</span><span class="p">,</span> <span class="n">classes</span> <span class="ow">in</span> <span class="n">dataloader</span><span class="p">:</span>
        <span class="o">...</span>
</pre></div>
</div>
<p>Running them with different concurrency, we get the following
performance.</p>
<div id='plot1'></div>

<script src='https://cdn.plot.ly/plotly-2.34.0.min.js'></script>
<script>
document.addEventListener('DOMContentLoaded', function() {

 var data = [
   {
     x: [1, 2, 4, 8, 16, 32],
     y: [280.47, 453.31, 538.37, 383.88, 248.95, 190.12],
     name: "PyTorch DataLoader",
     line: {
       color: '#fd7f6f',
       size: 8,
     },
   },
   {
     x: [1, 2, 4, 8, 16, 32],
     y: [313.27, 543.71, 814.35, 1002.36, 690.77, 812.93],
     name: "SPDL Pipeline",
     xaxis: "x",
     line: {
       color: '#7eb0d5',
     },
     marker : {
       symbol: 'x',
       size: 8,
     },
   },
 ];

 Plotly.newPlot(
   'plot1', {
     data: data,
     layout: {
       title:'Comparison of PyTorch DataLoader and SPDL Pipeline (No Batching)',
       xaxis: {
         title: {
           text: "Number of workers",
         },
         tickmode: "array",
         tickvals: [1, 2, 4, 8, 16, 32],
         tickangle: 0,
       },
       yaxis: {
         title: {
           text: "FPS",
         }
       },
       annotations: [
         {
           text: "",
           showarrow: false,
           align: 'center',
           x: 0.03,
           y: 0.98,
           xref: 'paper',
           yref: 'paper',
         },
       ]
     },
   },
 );

 }, false);
</script><p>SPDL Pipeline is faster than PyTorch DataLoader at all stages,
which suggests that the operations executed here
(Image decoding, resizing and Tensor conversions) all release GIL.</p>
<p>Many PyTorch operators (and also NumPy operators) release GIL,
so there is a good chance that they work fine in thread-based pipeline.</p>
</section>
<section id="batching-images">
<h2>Batching images<a class="headerlink" href="#batching-images" title="Link to this heading">¶</a></h2>
<p>Now we know that the basic loading operation works, we add batching.
In PyTorch DataLoader, providing <cite>batch_size</cite> enables batching
internally.</p>
<p>By default, it uses <a class="reference external" href="https://docs.pytorch.org/docs/stable/data.html#torch.utils.data.default_collate" title="(in PyTorch v2.9)"><code class="xref py py-func docutils literal notranslate"><span class="pre">torch.utils.data.default_collate()</span></code></a>
function.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">dataloader</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">DataLoader</span><span class="p">(</span>
    <span class="n">dataset</span><span class="p">,</span>
    <span class="n">batch_size</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span>
    <span class="c1"># ^^^^^^^^^^^^</span>
    <span class="n">num_workers</span><span class="o">=</span><span class="n">num_workers</span><span class="p">,</span>
<span class="p">)</span>

<span class="k">for</span> <span class="n">batch</span><span class="p">,</span> <span class="n">classes</span> <span class="ow">in</span> <span class="n">dataloader</span><span class="p">:</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>In SPDL, we use <code class="xref py py-meth docutils literal notranslate"><span class="pre">aggregate()</span></code>
method to buffer the results coming from upstream into a list.</p>
<p>The the buffered items need to be passed to collate function explicitly.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pipeline</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">PipelineBuilder</span><span class="p">()</span>
    <span class="o">.</span><span class="n">add_source</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dataset</span><span class="p">)))</span>
    <span class="o">.</span><span class="n">pipe</span><span class="p">(</span>
        <span class="n">dataset</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">,</span>
        <span class="n">concurrency</span><span class="o">=</span><span class="n">num_workers</span><span class="p">,</span>
        <span class="n">output_order</span><span class="o">=</span><span class="s2">&quot;input&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="o">.</span><span class="n">aggregate</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span>
    <span class="c1"># ^^^^^^^^^^^^</span>
    <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">default_collate</span><span class="p">)</span>
    <span class="c1"># ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span>
    <span class="o">.</span><span class="n">add_sink</span><span class="p">(</span><span class="n">prefetch_factor</span><span class="p">)</span>
    <span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="n">num_threads</span><span class="o">=</span><span class="n">num_workers</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Running this, we get the following result.</p>
<div id='plot2'></div>

<script src='https://cdn.plot.ly/plotly-2.34.0.min.js'></script>
<script>
document.addEventListener('DOMContentLoaded', function() {

 var data = [
   {
     x: [1, 2, 4, 8, 16, 32],
     y: [305.98, 553.72, 959.84, 1088.73, 1049.93, 603.32],
     name: "PyTorch DataLoader",
     line: {
       color: '#fd7f6f',
       size: 8,
     },
   },
   {
     x: [1, 2, 4, 8, 16, 32],
     y: [308.37, 532.15, 781.91, 883.15, 954.62, 897.19,],
     name: "SPDL Pipeline",
     xaxis: "x",
     line: {
       color: '#7eb0d5',
     },
     marker : {
       symbol: 'x',
       size: 8,
     },
   },
 ];

 Plotly.newPlot(
   'plot2', {
     data: data,
     layout: {
       title:'Comparison of PyTorch DataLoader and SPDL (Batch=32)',
       xaxis: {
         title: {
           text: "Number of workers",
         },
         tickmode: "array",
         tickvals: [1, 2, 4, 8, 16, 32],
         tickangle: 0,
       },
       yaxis: {
         title: {
           text: "FPS",
         }
       },
       annotations: [
         {
           text: "",
           showarrow: false,
           align: 'center',
           x: 0.03,
           y: 0.98,
           xref: 'paper',
           yref: 'paper',
         },
       ]
     },
   },
 );

 }, false);
</script><p>The batching gives huge boost to PyTorch DataLoader pipeline, while
SPDL becomes slightly slower than before.
Now, PyTorch DataLoader is faster than SPDL Pipeline.</p>
<p>This means that, simply running the existing data loading pipeline, which
is designed for multi-processing, does not improve the performance.</p>
<p>This might change with free-threaded, but that’s the current state, and
also the reason why SPDL cannot provide a simple drop-in replacement of
PyTorch DataLoader class.</p>
<p>To understand how to workaround this, let’s see how both pipelines scale.</p>
</section>
<section id="understanding-the-performance-trend">
<h2>Understanding the Performance Trend<a class="headerlink" href="#understanding-the-performance-trend" title="Link to this heading">¶</a></h2>
<p>We run the same pipeline while changing the batch size from 32 to 256 and see
how they scale.</p>
<div id='plot3'></div>

<script src='https://cdn.plot.ly/plotly-2.34.0.min.js'></script>
<script>
document.addEventListener('DOMContentLoaded', function() {

 var data = [
   {
     x: [1, 2, 4, 8, 16, 32],
     y: [301.5644774376562, 552.5811731298824, 1049.7137752041854, 1551.5779812300989, 1648.395135552321, 1205.7405046319166],
     name: "Batch size: 32",
     line: {
       color: '#c23728',
       dash: "dashdot"
     },
     marker : {
       size: 8,
     },
   },
   {
     x: [1, 2, 4, 8, 16, 32],
     y: [297.5708990305781, 582.5580997660737, 976.77763373665, 1227.7370795434795, 1145.3328444419305, 524.4662522482384],
     name: "64",
     line: {
       color: '#e14b31',
       dash: 'dashdot',
     },
     marker : {
       symbol: 'x',
       size: 8,
     },
   },
   {
     x: [1, 2, 4, 8, 16, 32],
     y: [308.7868774220196, 556.1609897991053, 898.6674650693486, 1106.5238879935084, 1062.508824198048, 609.2062900440113],
     name: "128",
     line: {
       color: '#de6e56',
       dash: "dashdot",
     },
     marker : {
       symbol: 'diamond',
       size: 8,
     },
   },
   {
     x: [1, 2, 4, 8, 16, 32],
     y: [302.6738133368564, 527.32510416939, 755.1745124865847, 974.958483718321, 942.6697816312729, 629.6534754853249],
     name: "256",
     line: {
       color: '#e1a692',
       dash: "dashdot",
     },
     marker : {
       symbol: 'star-triangle-up',
       size: 8,
     },
   },
 ];

 Plotly.newPlot(
   'plot3', {
     data: data,
     layout: {
       title:'How PyTorch DataLoader with different batch size',
       xaxis: {
         title: {
           text: "Number of workers",
         },
         tickmode: "array",
         tickvals: [1, 2, 4, 8, 16, 32],
         tickangle: 0,
       },
       yaxis: {
         title: {
           text: "FPS",
         }
       },
       annotations: [
         {
           text: "",
           showarrow: false,
           align: 'center',
           x: 0.03,
           y: 0.98,
           xref: 'paper',
           yref: 'paper',
         },
       ]
     },
   },
 );

 }, false);
</script><div id='plot4'></div>

<script src='https://cdn.plot.ly/plotly-2.34.0.min.js'></script>
<script>
document.addEventListener('DOMContentLoaded', function() {

 var data = [
   {
     x: [1, 2, 4, 8, 16, 32],
     y: [299.32863054890163, 521.2738145426497, 636.7112970156704, 805.540312136391, 774.2887606843312, 656.1341519286198],
     name: "Batch size: 32",
     line: {
       color: '#1984c5',
     },
     marker : {
       size: 8,
     },
   },
   {
     x: [1, 2, 4, 8, 16, 32],
     y: [309.12709790257793, 533.5636837173543, 782.6485036524888, 961.9161569894544, 983.338992149255, 1008.5413883853007],
     name: "64",
     xaxis: "x",
     line: {
       color: '#22a7f0',
     },
     marker : {
       symbol: 'x',
       size: 8,
     },
   },
   {
     x: [1, 2, 4, 8, 16, 32],
     y: [313.62267945432677, 523.7491634186161, 781.6572602273175, 909.238129213959, 1038.2839298453534, 1082.324863228146],
     name: "128",
     xaxis: "x",
     line: {
       color: '#63bff0',
     },
     marker : {
       symbol: 'diamond',
       size: 8,
     },
   },
   {
     x: [1, 2, 4, 8, 16, 32],
     y: [308.81126501151203, 554.0675704811672, 807.7339173136127, 1006.1029865532029, 1028.271712798735, 1070.1808294068285],
     name: "256",
     xaxis: "x",
     line: {
       color: '#a7d5ed',
     },
     marker : {
       symbol: 'star-triangle-up',
       size: 8,
     },
   },
 ];

 Plotly.newPlot(
   'plot4', {
     data: data,
     layout: {
       title:'How SPDL Pipeline scale with different batch size',
       xaxis: {
         title: {
           text: "Number of workers",
         },
         tickmode: "array",
         tickvals: [1, 2, 4, 8, 16, 32],
         tickangle: 0,
       },
       yaxis: {
         title: {
           text: "FPS",
         }
       },
       annotations: [
         {
           text: "",
           showarrow: false,
           align: 'center',
           x: 0.03,
           y: 0.98,
           xref: 'paper',
           yref: 'paper',
         },
       ]
     },
   },
 );

 }, false);
</script><p>We can make the following observations.</p>
<ol class="arabic simple">
<li><p>PyTorch DataLoader does not scale well beyond 8-16 workers,
while SPDL Pipeline can achieve similar or higher throughput.</p></li>
<li><p>As the batch size increases, PyTorch DataLoader’s peak throughput drops,
while SPDL Pipeline sustain similar or even higher throughput.</p></li>
<li><p>The way SPDL Pipeline’s performance scale is consistent for different batch sizes.</p></li>
</ol>
<p>Why does the performance of PyTorch DataLoader drops as the batch size increase?
And why it’s not the case for SPDL Pipeline?</p>
<p>Since they use the same operations, we can deduce that the difference is coming from
process and thread.
One of the major difference between process-based and thread-based data preparation
is the treatment of the batch after its creation.</p>
<p>The following figure shows in detail how images are prepared when using PyTorch
DataLoader.</p>
<div class="mermaid">
            flowchart TB
     subgraph SP[Subprocess]
         subgraph TV[TorchVision/Pillow]
         Source --Decode--&gt; F0[YUV] --Convert--&gt; F1[RGB] --Resize--&gt; F2[RGB] --To Contiguous--&gt; T1[Tensor]
         T2[Tensor]
         end
         T1 --Copy--&gt; B1[Batch] --Pixel Normalization--&gt; B2[Batch]
         T2 --Copy--&gt; B1
     end
     Pipe
     subgraph MP[Main Process]
         B3[Batch] --GPU Transfer--&gt; B4[Batch]

     end

     SP --Deserialize--&gt; Pipe --Serialize--&gt; MP
        </div><p>The batch created in a background process is serialized into byte string and written to
the memory space shared between the main process and the background process.
The main process then deserialize the byte string and re-create the batch.</p>
<p>This means that the batch tensor is at least copied twice after its creation.</p>
<p>So as the size of the batch tensor grows, the main process needs to allocate and copy more
memory to fetch the batch.</p>
<p>In SPDL Pipeline, this is not the case because it uses threads to execute works concurrently.
Threads, unlike processes, share the memory space, so the batch tensor created by the background
thread can be directly used by the main thread. There is no need to copy it.</p>
</section>
<section id="switching-to-spdl-i-o">
<h2>Switching to SPDL I/O<a class="headerlink" href="#switching-to-spdl-i-o" title="Link to this heading">¶</a></h2>
<p>In addition to the redundant memory copy originated from inter-process communication, there
are few more memory-related inefficiency in the pipelines.</p>
<p>The image data coming out of <a class="reference external" href="https://docs.pytorch.org/vision/stable/generated/torchvision.datasets.ImageNet.html#torchvision.datasets.ImageNet" title="(in Torchvision v0.24)"><code class="xref py py-class docutils literal notranslate"><span class="pre">ImageNet</span></code></a> is Tensor, which is
contiguous memory format. In media processing, the data are more often represented as
non-contiguous memories regions (like separate image planes),
and usually they are not in the size.
For example, YUV420 format, which is one of the most commonly used format uses 12 bits per
pixel to store data, while RGB tensors uses 24 bits per pixel of contiguous memory.</p>
<p>Loading JPEG files using Pillow converts the data to RGB.
This RGB data is then resized to the target resolution, and converted to a Tensor representing
a single image. Finally, image tensors are copied into batch Tensor.</p>
<p>This process adds multiple of redundant memory allocations and copying.</p>
<p>Let’s do a back-of-the-envelope calculation to see how wasteful this can be.
Suppose we want to create a batch of 32 images at 224x224 and all the source images are
720x480 YUV420 format.</p>
<p>One decoded image kept at YUV420 format occupies 720x480x12 = 4147200 bits ~= 0.52 MB.
When this images is converted to RGB, then it occupies twice the size of YUV420, 1.04 MB.
So converting images to RGB after loading consumes extra 32x0.52 = 16 MB of memory.</p>
<p>Next, once the image is resized to 224x224 RGB format, TorchVision/Pillow convert the data
to Tensors of single images. That is, 32 of contiguous 224x224x3 bytes ~= 4.8 MB is
allocated, copied but discarded when batch tensor is created.</p>
<p>Therefore, when using Pillow and TorchVision, creating a batch of 32 images at 224x224
(which is 4.8 MB) allocates, copies and discards redundant memory of about 20MB.</p>
<p>When this data is transferred from sub-process to the main process, 2x4.8 MB extra copies
are created.</p>
<p>In SPDL, we implemented the I/O module, which avoids these redundant memory allocations and
copying, and converts the data to contiguous format only when batching the resulted images.</p>
<p>The following figure illustrates the SPDL pipeline with this SPDL I/O module at the same
level of abstraction as the previous PyTorch DataLoader figure.</p>
<div class="mermaid">
            flowchart LR
     subgraph MP[Main Process]
         direction LR
         subgraph Decode[SPDL I/O]
         Source --Decode--&gt; F0[YUV] --Resize--&gt; F1[YUV] --Convert--&gt; F2[RGB] --Copy--&gt; B1[Batch]
         F3[RGB] --Copy--&gt; B1
         end
         B1 --Pixel Normalization--&gt; B2[Batch] --Transfer--&gt; GPU
     end
        </div><p>The image processing part has fewer steps than PyTorch DataLoader equivalent.</p>
<p>Let’s swap the image decoding part and see how it helps.</p>
<p>We change the image decoding part (which was happening inside of
<a class="reference external" href="https://docs.pytorch.org/vision/stable/generated/torchvision.datasets.ImageNet.html#torchvision.datasets.ImageNet" title="(in Torchvision v0.24)"><code class="xref py py-class docutils literal notranslate"><span class="pre">ImageNet</span></code></a> class) as follow.</p>
<p>First, we implement the function that decodes an image, but does not convert it to Tensor yet.
The result of <a class="reference internal" href="../generated/spdl.io.decode_packets.html#spdl.io.decode_packets" title="spdl.io.decode_packets"><code class="xref py py-func docutils literal notranslate"><span class="pre">spdl.io.decode_packets()</span></code></a> is <a class="reference internal" href="../generated/spdl.io.ImageFrames.html#spdl.io.ImageFrames" title="spdl.io.ImageFrames"><code class="xref py py-class docutils literal notranslate"><span class="pre">ImageFrames</span></code></a>, which holds
the frame data decoded by FFmpeg as-is.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="n">filter_desc</span> <span class="o">=</span> <span class="n">spdl</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">get_video_filter_desc</span><span class="p">(</span>
     <span class="n">scale_width</span><span class="o">=</span><span class="mi">224</span><span class="p">,</span>
     <span class="n">scale_height</span><span class="o">=</span><span class="mi">224</span><span class="p">,</span>
 <span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">decode_image</span><span class="p">(</span><span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ImageFrames</span><span class="p">:</span>
    <span class="n">packets</span> <span class="o">=</span> <span class="n">spdl</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">demux_image</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">spdl</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">decode_packets</span><span class="p">(</span><span class="n">packets</span><span class="p">,</span> <span class="n">filter_desc</span><span class="o">=</span><span class="n">filter_desc</span><span class="p">)</span>
</pre></div>
</div>
<p>Then we swap the image decoding function.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">dataset</span> <span class="o">=</span> <span class="n">ImageNet</span><span class="p">(</span>
    <span class="s2">&quot;dataset_directory&quot;</span><span class="p">,</span>
    <span class="n">loader</span> <span class="o">=</span> <span class="n">decode_image</span><span class="p">,</span>
    <span class="c1"># ^^^^^^^^^^^^^^^^^^^</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Then we implement a batching function, which is somewhat equivalent to collate function, but
its inputs are not Tensor.
The <a class="reference internal" href="../generated/spdl.io.convert_frames.html#spdl.io.convert_frames" title="spdl.io.convert_frames"><code class="xref py py-func docutils literal notranslate"><span class="pre">spdl.io.convert_frames()</span></code></a> function receives multiple Frame objects and create one
contiguous memory and copies the data from the Frames.
The result is a <a class="reference internal" href="../generated/spdl.io.CPUBuffer.html#spdl.io.CPUBuffer" title="spdl.io.CPUBuffer"><code class="xref py py-class docutils literal notranslate"><span class="pre">spdl.io.CPUBuffer</span></code></a> instance, which implements
<a class="reference external" href="https://numpy.org/doc/stable/reference/arrays.interface.html">NumPy Array Interface</a>, so it
can be converted to PyTorch Tensor without copying data.
<a class="reference internal" href="../generated/spdl.io.to_torch.html#spdl.io.to_torch" title="spdl.io.to_torch"><code class="xref py py-func docutils literal notranslate"><span class="pre">spdl.io.to_torch()</span></code></a> function performs this operation.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">convert</span><span class="p">(</span><span class="n">items</span><span class="p">):</span>
    <span class="n">frames</span><span class="p">,</span> <span class="n">clsses</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">items</span><span class="p">))</span>
    <span class="n">buffer</span> <span class="o">=</span> <span class="n">spdl</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">convert_frames</span><span class="p">(</span><span class="n">frames</span><span class="p">)</span>
    <span class="n">tensor</span> <span class="o">=</span> <span class="n">spdl</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">to_torch</span><span class="p">(</span><span class="n">buffer</span><span class="p">)</span><span class="o">.</span><span class="n">permute</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">tensor</span><span class="p">,</span> <span class="n">clsses</span>
</pre></div>
</div>
<p>Then we put them together to build the Pipeline.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pipeline</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">PipelineBuilder</span><span class="p">()</span>
    <span class="o">.</span><span class="n">add_source</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dataset</span><span class="p">)))</span>
    <span class="o">.</span><span class="n">pipe</span><span class="p">(</span>
        <span class="n">dataset</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">,</span>
        <span class="n">concurrency</span><span class="o">=</span><span class="n">num_workers</span><span class="p">,</span>
        <span class="n">output_order</span><span class="o">=</span><span class="s2">&quot;input&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="o">.</span><span class="n">aggregate</span><span class="p">(</span><span class="n">batch_size</span><span class="p">)</span>
    <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">convert</span><span class="p">)</span>
    <span class="o">.</span><span class="n">add_sink</span><span class="p">(</span><span class="n">prefetch_factor</span><span class="p">)</span>
    <span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="n">num_threads</span><span class="o">=</span><span class="n">num_workers</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Running the pipeline with different number of threads, we get the following result.</p>
<div id='plot5'></div>

<script src='https://cdn.plot.ly/plotly-2.34.0.min.js'></script>
<script>
document.addEventListener('DOMContentLoaded', function() {

 var data = [
   {
     x: [1, 2, 4, 8, 16, 32],
     y: [301.5644774376562, 552.5811731298824, 1049.7137752041854, 1551.5779812300989, 1648.395135552321, 1205.7405046319166],
     name: "PyTorch - Batch size: 32",
     line: {
       color: '#c23728',
       dash: "dashdot"
     },
     marker : {
       size: 8,
     },
   },
   {
     x: [1, 2, 4, 8, 16, 32],
     y: [297.5708990305781, 582.5580997660737, 976.77763373665, 1227.7370795434795, 1145.3328444419305, 524.4662522482384],
     name: "PyTorch - 64",
     line: {
       color: '#e14b31',
       dash: 'dashdot',
     },
     marker : {
       symbol: 'x',
       size: 8,
     },
   },
   {
     x: [1, 2, 4, 8, 16, 32],
     y: [308.7868774220196, 556.1609897991053, 898.6674650693486, 1106.5238879935084, 1062.508824198048, 609.2062900440113],
     name: "PyTorch - 128",
     line: {
       color: '#de6e56',
       dash: "dashdot",
     },
     marker : {
       symbol: 'diamond',
       size: 8,
     },
   },
   {
     x: [1, 2, 4, 8, 16, 32],
     y: [302.6738133368564, 527.32510416939, 755.1745124865847, 974.958483718321, 942.6697816312729, 629.6534754853249],
     name: "PyTorch - 256",
     line: {
       color: '#e1a692',
       dash: "dashdot",
     },
     marker : {
       symbol: 'star-triangle-up',
       size: 8,
     },
   },
   {
     x: [1, 2, 4, 8, 16, 32],
     y: [354.9718942814155, 653.7757652430607, 1091.3357365923227, 1616.5907164857824, 2077.4848591176374, 2416.8325254963897],
     name: "SPDL (with I/O) - 32",
     line: {
       color: '#54bebe',
       dash: 'dot',
     },
     marker : {
       size: 8,
     },
   },
   {
     x: [1, 2, 4, 8, 16, 32],
     y: [358.056426004455, 654.9588664891398, 1079.4914828201856, 1594.8675090155166, 1988.5114781043144, 2391.4568408297378],
     name: "SPDL (with I/O) - 64",
     xaxis: "x",
     line: {
       color: '#76c8c8',
       dash: 'dot',
     },
     marker : {
       symbol: 'x',
       size: 8,
     },
   },
   {
     x: [1, 2, 4, 8, 16, 32],
     y: [356.10702213976236, 661.3346961833475, 1097.8671922765789, 1590.8816075260706, 1997.4952994520272, 2130.0032224215465],
     name: "SPDL (with I/O) - 128",
     xaxis: "x",
     line: {
       color: '#63bff0',
       dash: 'dot',
     },
     marker : {
       symbol: '98d1d1',
       size: 8,
     },
   },
   {
     x: [1, 2, 4, 8, 16, 32],
     y: [357.81069984748797, 663.8329727465781, 1108.0290804302906, 1627.7253877128985, 2015.1510341303645, 2428.9182138750334],
     name: "SPDL (with I/O) - 256",
     xaxis: "x",
     line: {
       color: '#badbdb',
       dash: 'dot',
     },
     marker : {
       symbol: 'star-triangle-up',
       size: 8,
     },
   },
 ];

 Plotly.newPlot(
   'plot5', {
     data: data,
     layout: {
       title:'Comparison of PyTorch DataLoader and SPDL Pipeline',
       xaxis: {
         title: {
           text: "Number of workers",
         },
         tickmode: "array",
         tickvals: [1, 2, 4, 8, 16, 32],
         tickangle: 0,
       },
       yaxis: {
         title: {
           text: "FPS",
         }
       },
       annotations: [
         {
           text: "",
           showarrow: false,
           align: 'center',
           x: 0.03,
           y: 0.98,
           xref: 'paper',
           yref: 'paper',
         },
       ]
     },
   },
 );

 }, false);
</script><p>The new pipeline is faster than PyTorch DataLoader at all the level of concurrency
and the size of the batch tensor.</p>
</section>
<section id="summary">
<h2>Summary<a class="headerlink" href="#summary" title="Link to this heading">¶</a></h2>
<p>We looked at how one can migrate from PyTorch DataLoader to SPDL Pipeline while
improving the performance of data loading.</p>
<p>The initial step can be mechanically applied, but to ensure that the resulting
pipeline is more performant, it is necessary to benchmark and adjust parts of the
pipeline.</p>
<p>We recommend to use <a class="reference internal" href="../generated/spdl.io.html#module-spdl.io" title="spdl.io"><code class="xref py py-mod docutils literal notranslate"><span class="pre">spdl.io</span></code></a> module for processing media data. It is
designed for scaling throughput and has small memory footprint.</p>
<p>For more complete performance analysis on the SPDL-based pipeline, please refer
to <a class="reference internal" href="../generated/multi_thread_preprocessing.html#module-multi_thread_preprocessing" title="multi_thread_preprocessing"><code class="xref py py-mod docutils literal notranslate"><span class="pre">multi_thread_preprocessing</span></code></a>.
This example measures the pipeline with more processing and GPU data transfer.</p>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="../best_practice.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Best Practices</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="paradigm_shift.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Paradigm Shift</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2025, Meta Platforms, Inc.
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Migrating from PyTorch DataLoader</a><ul>
<li><a class="reference internal" href="#decoding-images-in-threads">Decoding images in threads</a></li>
<li><a class="reference internal" href="#batching-images">Batching images</a></li>
<li><a class="reference internal" href="#understanding-the-performance-trend">Understanding the Performance Trend</a></li>
<li><a class="reference internal" href="#switching-to-spdl-i-o">Switching to SPDL I/O</a></li>
<li><a class="reference internal" href="#summary">Summary</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div>
    <script src="../_static/js/custom.js"></script><script src="../_static/documentation_options.js?v=d0952cc8"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/scripts/furo.js?v=5fa4622c"></script>
    <script src="../_static/collapsible-lists/js/CollapsibleLists.compressed.js?v=73120307"></script>
    <script src="../_static/collapsible-lists/js/apply-collapsible-lists.js?v=660e4f45"></script>
    <script src="https://unpkg.com/mermaid@11.10.0/dist/mermaid.min.js"></script>
    <script>mermaid.initialize({startOnLoad:true});</script>
    </body>
</html>