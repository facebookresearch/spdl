<!doctype html>
<html class="no-js" lang="en" data-content_root="../">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="Index" href="../genindex.html" /><link rel="search" title="Search" href="../search.html" /><link rel="next" title="Metrics across Ranks" href="fleet_metrics.html" /><link rel="prev" title="Composition of Pipeline" href="setup.html" />

    <!-- Generated with Sphinx 7.4.7 and Furo 2024.07.18 -->
        <title>Analyzing the Performance - SPDL 0.1.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=8f2a1f02" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css?v=613ab9ff" />
    <link rel="stylesheet" type="text/css" href="../_static/collapsible-lists/css/tree_view.css?v=a885cde7" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css?v=302659d7" />
    <link rel="stylesheet" type="text/css" href="../_static/css/custom.css?v=a8e03d5d" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-SNXS50Q2E3"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-SNXS50Q2E3');
</script>
</head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">SPDL 0.1.0 documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../index.html">
  
  
  <span class="sidebar-brand-text">SPDL 0.1.0 documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul>
<li class="toctree-l1"><a class="reference internal" href="../index.html">Home</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../getting_started/index.html">Getting Started</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of Getting Started</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../getting_started/intro.html">Building and Running Pipeline</a></li>
<li class="toctree-l2"><a class="reference internal" href="../getting_started/stages.html">Pipeline Stages</a></li>
<li class="toctree-l2"><a class="reference internal" href="../getting_started/concurrency.html">Concurrency</a></li>
<li class="toctree-l2"><a class="reference internal" href="../getting_started/parallelism.html">Pipeline Parallelism</a></li>
<li class="toctree-l2"><a class="reference internal" href="../getting_started/logging.html">Collecting Runtime Statistics</a></li>
</ul>
</li>
<li class="toctree-l1 current has-children"><a class="reference internal" href="index.html">Optimization Guide</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle navigation of Optimization Guide</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="headspace_analysis.html">Headspace Analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="noisy_neighbour.html">Noisy Neighbour</a></li>
<li class="toctree-l2"><a class="reference internal" href="setup.html">Composition of Pipeline</a></li>
<li class="toctree-l2 current current-page"><a class="current reference internal" href="#">Analyzing the Performance</a></li>
<li class="toctree-l2"><a class="reference internal" href="fleet_metrics.html">Metrics across Ranks</a></li>
<li class="toctree-l2"><a class="reference internal" href="resolution.html">Resolving the Bottleneck</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../case_studies/index.html">Case Studies</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle navigation of Case Studies</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../case_studies/parallelism.html">Parallelism and Performance</a></li>
<li class="toctree-l2"><a class="reference internal" href="../case_studies/data_format.html">Data Format and Performance</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../migration/index.html">Migration Guide</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle navigation of Migration Guide</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../migration/why.html">Why migrate to SPDL?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../migration/paradigm_shift.html">Paradigm Shift</a></li>
<li class="toctree-l2"><a class="reference internal" href="../migration/pytorch.html">Migrating from PyTorch DataLoader</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../best_practice.html">Best Practices</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../examples.html">Examples</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"/><label for="toctree-checkbox-5"><div class="visually-hidden">Toggle navigation of Examples</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../generated/image_dataloading.html">Image dataloading</a></li>
<li class="toctree-l2"><a class="reference internal" href="../generated/video_dataloading.html">Video dataloading</a></li>
<li class="toctree-l2"><a class="reference internal" href="../generated/imagenet_classification.html">Imagenet classification</a></li>
<li class="toctree-l2"><a class="reference internal" href="../generated/multi_thread_preprocessing.html">Multi thread preprocessing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../generated/streaming_nvdec_decoding.html">Streaming nvdec decoding</a></li>
<li class="toctree-l2"><a class="reference internal" href="../generated/streaming_video_processing.html">Streaming video processing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../generated/performance_analysis.html">Performance analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../generated/data_formats.html">Data formats</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../faq.html">Frequently Asked Questions</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API References</span></p>
<ul>
<li class="toctree-l1 has-children"><a class="reference internal" href="../api.html">API Reference</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" role="switch" type="checkbox"/><label for="toctree-checkbox-6"><div class="visually-hidden">Toggle navigation of API Reference</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../generated/spdl.pipeline.html">spdl.pipeline</a></li>
<li class="toctree-l2"><a class="reference internal" href="../generated/spdl.dataloader.html">spdl.dataloader</a></li>
<li class="toctree-l2"><a class="reference internal" href="../generated/spdl.source.html">spdl.source</a></li>
<li class="toctree-l2"><a class="reference internal" href="../generated/spdl.io.html">spdl.io</a></li>
<li class="toctree-l2"><a class="reference internal" href="../generated/spdl.io.utils.html">spdl.io.utils</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../cpp.html">API Reference (C++)</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" role="switch" type="checkbox"/><label for="toctree-checkbox-7"><div class="visually-hidden">Toggle navigation of API Reference (C++)</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../generated/libspdl/libspdl_class.html">Class List</a></li>
<li class="toctree-l2"><a class="reference internal" href="../generated/libspdl/libspdl_file.html">File List</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../generated/libspdl/libspdl_api.html">API</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" role="switch" type="checkbox"/><label for="toctree-checkbox-8"><div class="visually-hidden">Toggle navigation of API</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/namespace_spdl.html">Namespace spdl</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/namespace_spdl__core.html">Namespace spdl::core</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/namespace_spdl__core__detail.html">Namespace spdl::core::detail</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/namespace_std.html">Namespace std</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/structAVRational.html">Struct AVRational</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/structspdl_1_1core_1_1BytesAdaptor.html">Struct BytesAdaptor</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/structspdl_1_1core_1_1CPUBuffer.html">Struct CPUBuffer</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/structspdl_1_1core_1_1DataInterface.html">Struct DataInterface</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/structspdl_1_1core_1_1DecodeConfig.html">Struct DecodeConfig</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/structspdl_1_1core_1_1DemuxConfig.html">Struct DemuxConfig</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/structspdl_1_1core_1_1EncodeConfigBase.html">Template Struct EncodeConfigBase</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/structspdl_1_1core_1_1Generator.html">Template Struct Generator</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/structspdl_1_1core_1_1Generator_1_1promise__type.html">Struct Generator::promise_type</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/structspdl_1_1core_1_1Packets.html">Template Struct Packets</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/structspdl_1_1core_1_1RawPacketData.html">Struct RawPacketData</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/structspdl_1_1core_1_1SourceAdaptor.html">Struct SourceAdaptor</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/structspdl_1_1core_1_1Storage.html">Struct Storage</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/classspdl_1_1core_1_1BSF.html">Template Class BSF</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/classspdl_1_1core_1_1Codec.html">Template Class Codec</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/classspdl_1_1core_1_1CPUStorage.html">Class CPUStorage</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/classspdl_1_1core_1_1Decoder.html">Template Class Decoder</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/classspdl_1_1core_1_1Demuxer.html">Class Demuxer</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/classspdl_1_1core_1_1detail_1_1DecoderImpl.html">Template Class DecoderImpl</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/classspdl_1_1core_1_1detail_1_1EncoderImpl.html">Template Class EncoderImpl</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/classspdl_1_1core_1_1Encoder.html">Template Class Encoder</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/classspdl_1_1core_1_1FilterGraph.html">Class FilterGraph</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/classspdl_1_1core_1_1Frames.html">Template Class Frames</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/classspdl_1_1core_1_1InternalError.html">Class InternalError</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/classspdl_1_1core_1_1Muxer.html">Class Muxer</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/classspdl_1_1core_1_1PacketSeries.html">Class PacketSeries</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/classspdl_1_1core_1_1StreamingDemuxer.html">Class StreamingDemuxer</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/classspdl_1_1core_1_1TracingSession.html">Class TracingSession</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/enum_types_8h_1a5422694500d2203e301dc182e5f63d22.html">Enum CodecID</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/enum_types_8h_1adb4e1adb2b3a59148c2797f903ead06f.html">Enum ElemClass</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/enum_types_8h_1ac22438cfd069f0b1b6a736e73e8d244c.html">Enum MediaType</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/function_frames_8h_1a30fbfab5f9ecfb208928ebdaca7f4349.html">Template Function spdl::core::clone</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/function_conversion_8h_1a3f08ca7a5c09ab82603e239e50dff4d7.html">Template Function spdl::core::convert_frames(const std::vector&lt;const Frames&lt;media&gt; *&gt;&amp;, std::shared_ptr&lt;CPUStorage&gt;)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/function_conversion_8h_1ae55bfac2f391205603d77241fc25ca1a.html">Template Function spdl::core::convert_frames(const Frames&lt;media&gt; *, std::shared_ptr&lt;CPUStorage&gt;)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/function_buffer_8h_1abb668d9a68635211e5e07bd5038df4aa.html">Function spdl::core::cpu_buffer</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/function_conversion_8h_1a295b42ad20d2569806d9a15009a44ca8.html">Function spdl::core::create_reference_audio_frame</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/function_conversion_8h_1a87d61e0429716c42f3a5f5e85aad5b61.html">Function spdl::core::create_reference_video_frame</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/function_packets_8h_1ad3bdea22ad439f82174ce27c26bec857.html">Function spdl::core::extract_packets_at_indices</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/function_utils_8h_1a0aef7b410dcb4075e477b10ba3e71f80.html">Function spdl::core::get_ffmpeg_filters</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/function_utils_8h_1ae1a3d30b33d837c39c40190e681d37c8.html">Function spdl::core::get_ffmpeg_log_level</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/function_utils_8h_1a0ebae69b46f68552c3f64ddc2af67f53.html">Function spdl::core::get_ffmpeg_versions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/function_packets_8h_1aae5ad1fd09f47a2978afef3921508da0.html">Template Function spdl::core::get_pts</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/function_utils_8h_1af82c781c7484afbad6cbac32ff925793.html">Function spdl::core::init_glog</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/function_utils_8h_1abbebef003881d8734c12e03a47814732.html">Function spdl::core::init_tracing</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/function_demuxing_8h_1ad3fdb02bd04d231cd7238e034c27711f.html">Function spdl::core::make_demuxer(const std::string&amp;, const SourceAdaptorPtr&amp;, const std::optional&lt;DemuxConfig&gt;&amp;)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/function_demuxing_8h_1a590baa95f8eeb6bc0092c723ff060dd4.html">Function spdl::core::make_demuxer(const std::string_view, const std::optional&lt;DemuxConfig&gt;&amp;)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/function_filter__graph_8h_1aaa3dba3ab905bd429d038f0bbaa6ce16.html">Function spdl::core::make_filter_graph</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/function_utils_8h_1aa1e91130e5d71e8c2a104e4f72296ff3.html">Function spdl::core::register_avdevices</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/function_utils_8h_1a9b6c16227a1a8445319b487cacb0cd1d.html">Function spdl::core::set_ffmpeg_log_level</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/function_utils_8h_1a893d39670b4169063d8f6e3723f4bc11.html">Template Function spdl::core::trace_counter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/function_utils_8h_1ae27a1cc3e5bfd9997090eb40711cc6c6.html">Function spdl::core::trace_event_begin</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/function_utils_8h_1a8f29c25b417b77e9dfb5a769b418c169.html">Function spdl::core::trace_event_end</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/define_frames_8h_1ac2ad95ac922a100ec27340436eb94940.html">Define _IS_AUDIO</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/define_frames_8h_1ac99c83df576500933a3691deb137be6d.html">Define _IS_IMAGE</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/define_frames_8h_1a9beaa64113e413112d43491ba5c13670.html">Define _IS_VIDEO</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/define_types_8h_1a3a6c4d7f842d451acf8717ce734385f2.html">Define SPDL_DEFAULT_BUFFER_SIZE</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/typedef_types_8h_1a6eff035c271caa5a533987a1e00ad43e.html">Typedef AVRational</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/typedef_frames_8h_1aba3a9982b74abb6be181dc4d247d53fa.html">Typedef spdl::core::AnyFrames</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/typedef_packets_8h_1ab96da01bb9cc9793e8ae2637e1dd610b.html">Typedef spdl::core::AnyPackets</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/typedef_codec_8h_1a9098e05b01da4afd02090b0d6d7624ba.html">Typedef spdl::core::AudioCodec</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/typedef_types_8h_1a23b168da4cdf96923387b92a43f20038.html">Typedef spdl::core::AudioEncodeConfig</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/typedef_encoder_8h_1a57216492ce017017647dba9d1f6f2a5d.html">Typedef spdl::core::AudioEncoder</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/typedef_encoder_8h_1a0dfcc06d4bbea67c7f45399be8719fa6.html">Typedef spdl::core::AudioEncoderPtr</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/typedef_frames_8h_1a5be56dffe8f2b76de9540fb1ad8b83bf.html">Typedef spdl::core::AudioFrames</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/typedef_frames_8h_1a9db8234daca15eb073d00fa762641b62.html">Typedef spdl::core::AudioFramesPtr</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/typedef_packets_8h_1a9644f8aa13f0e4db02d8ab60673563a3.html">Typedef spdl::core::AudioPackets</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/typedef_packets_8h_1ab2cc72fb6b931466960bd4b9f812784c.html">Typedef spdl::core::AudioPacketsPtr</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/typedef_buffer_8h_1ab6e5b43497adbd35e9fbc35cf5be7101.html">Typedef spdl::core::CPUBufferPtr</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/typedef_adaptor_8h_1adcb670a31326eb24268b384396736cd6.html">Typedef spdl::core::DataInterfacePtr</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/typedef_decoder_8h_1a4b0502ea20d1dda958a67deeb582a74b.html">Typedef spdl::core::DecoderPtr</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/typedef_demuxing_8h_1a4b53016f9b756cc2c2cfbd0e5ad9558b.html">Typedef spdl::core::DemuxerPtr</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/typedef_encoder_8h_1aacfba556b86e2d663a004b8677567339.html">Typedef spdl::core::EncoderPtr</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/typedef_filter__graph_8h_1a29554b40f89e4b227521ff86ccf69b8b.html">Typedef spdl::core::FilterGraphPtr</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/typedef_frames_8h_1ad628496b3863230dd76eeccc4fa66437.html">Typedef spdl::core::FramesPtr</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/typedef_codec_8h_1a606d432c7b033a787f653c4992937e6f.html">Typedef spdl::core::ImageCodec</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/typedef_frames_8h_1a53a3c93ef56a4400fabd3a553ab21c4a.html">Typedef spdl::core::ImageFrames</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/typedef_frames_8h_1a3760130bba382ba7f15df177ca3374c7.html">Typedef spdl::core::ImageFramesPtr</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/typedef_packets_8h_1af018ade1cd38831c342686abbcb787a8.html">Typedef spdl::core::ImagePackets</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/typedef_packets_8h_1a8b9c8b08fcbf891fa939700ecd807ce1.html">Typedef spdl::core::ImagePacketsPtr</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/typedef_muxer_8h_1aaa76352d246819df02bc407729f69dda.html">Typedef spdl::core::MuxerPtr</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/typedef_types_8h_1aa5d8175da6bbcbe93e7191461f7baa20.html">Typedef spdl::core::OptionDict</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/typedef_packets_8h_1a331b599d0eceb00ebef166d64623c71a.html">Typedef spdl::core::PacketSeriesPtr</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/typedef_packets_8h_1aad5761fe07714efccc2be969a4397354.html">Typedef spdl::core::PacketsPtr</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/typedef_types_8h_1a8bd80c8465b1f3e17b564c5ced977a2d.html">Typedef spdl::core::Rational</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/typedef_adaptor_8h_1adfe58c3c3a3d3171c1d69c2e9924f2a7.html">Typedef spdl::core::SourceAdaptorPtr</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/typedef_demuxing_8h_1a0a7f8c140cd7110dc5f3f6537fae67db.html">Typedef spdl::core::StreamingDemuxerPtr</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/typedef_codec_8h_1ac7441badce2b2aa467eac09b35d4f81e.html">Typedef spdl::core::VideoCodec</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/typedef_types_8h_1a8b310bdb98714a971b07aa58f7403529.html">Typedef spdl::core::VideoEncodeConfig</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/typedef_encoder_8h_1a383bf2b0ac1564702f10e3b5f3ef03f6.html">Typedef spdl::core::VideoEncoder</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/typedef_encoder_8h_1a39ace4ea741767fa3d802040a9bc22e1.html">Typedef spdl::core::VideoEncoderPtr</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/typedef_frames_8h_1af1892953097f3723455403752ef79fc5.html">Typedef spdl::core::VideoFrames</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/typedef_frames_8h_1acb0efeb222082bf955c71c74964d301d.html">Typedef spdl::core::VideoFramesPtr</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/typedef_packets_8h_1a7be7c9faccc623d12fb33ec966f84b4c.html">Typedef spdl::core::VideoPackets</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generated/libspdl/typedef_packets_8h_1aa21b44d594bfc132b4252fd2f544a691.html">Typedef spdl::core::VideoPacketsPtr</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../genindex.html">API Index</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Development Notes</span></p>
<ul>
<li class="toctree-l1 has-children"><a class="reference internal" href="../notes/index.html">Development Notes</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" role="switch" type="checkbox"/><label for="toctree-checkbox-9"><div class="visually-hidden">Toggle navigation of Development Notes</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../notes/pipeline_impl.html">Implementation detail of Pipeline</a></li>
</ul>
</li>
</ul>

</div>
</div>
<div class="sidebar-tree">
<ul>
  <li class="toctree-l1 has-children">
    <span class="reference">Versions</span>
    <input class="toctree-checkbox" id="toctree-checkbox-versions" name="toctree-checkbox-versions" role="switch" type="checkbox">
    <label for="toctree-checkbox-versions">
      <div class="visually-hidden">Toggle navigattion of Versions</div>
      <i class="icon">
        <svg>
          <use href="#svg-arrow-right"></use>
        </svg>
      </i>
    </label>
    <ul>
      <li class="toctree-l2"><a class="reference internal" href="/spdl/main">dev</a></li>
      <li class="toctree-l2"><a class="reference internal" href="/spdl/latest">latest-release</a></li>
      <li class="toctree-l2"><a class="reference internal" href="/spdl/0.1.0">0.1.0</a></li>
      <li class="toctree-l2"><a class="reference internal" href="/spdl/0.0.14">0.0.14</a></li>
      <li class="toctree-l2"><a class="reference internal" href="/spdl/0.0.13">0.0.13</a></li>
      <li class="toctree-l2"><a class="reference internal" href="/spdl/0.0.12">0.0.12</a></li>
      <li class="toctree-l2"><a class="reference internal" href="/spdl/0.0.11">0.0.11</a></li>
      <li class="toctree-l2"><a class="reference internal" href="/spdl/0.0.10">0.0.10</a></li>
      <li class="toctree-l2"><a class="reference internal" href="/spdl/0.0.9">0.0.9</a></li>
      <li class="toctree-l2"><a class="reference internal" href="/spdl/0.0.8">0.0.8</a></li>
    </ul>
  </li>
</ul>
</div>
      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="view-this-page">
  <a class="muted-link" href="../_sources/optimization_guide/analysis.rst.txt" title="View this page">
    <svg><use href="#svg-eye"></use></svg>
    <span class="visually-hidden">View this page</span>
  </a>
</div>
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <section id="analyzing-the-performance">
<span id="analysis"></span><h1>Analyzing the Performance<a class="headerlink" href="#analyzing-the-performance" title="Link to this heading">¶</a></h1>
<p>In this section, we examine the performance statistics gathered from
a production training system.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>To setup the pipeline to collect runtime performance statistics,
please refer to the <a class="reference internal" href="../getting_started/logging.html#logging"><span class="std std-ref">Collecting Runtime Statistics</span></a>
section and the <a class="reference internal" href="../generated/performance_analysis.html#module-performance_analysis" title="performance_analysis"><code class="xref py py-mod docutils literal notranslate"><span class="pre">performance_analysis</span></code></a> example.</p>
</div>
<p>The pipeline consists of four stages: download, preprocess, batch,
and transfer. The following code snippet and diagram illustrate this.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pipeline</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">PipelineBuilder</span><span class="p">()</span>
    <span class="o">.</span><span class="n">add_source</span><span class="p">(</span><span class="n">Dataset</span><span class="p">())</span>
    <span class="o">.</span><span class="n">aggregate</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span>
    <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">download</span><span class="p">,</span> <span class="n">concurrency</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
    <span class="o">.</span><span class="n">disaggregate</span><span class="p">()</span>
    <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">preprocess</span><span class="p">,</span> <span class="n">concurrency</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
    <span class="o">.</span><span class="n">aggregate</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
    <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">collate</span><span class="p">)</span>
    <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">gpu_transfer</span><span class="p">)</span>
    <span class="o">.</span><span class="n">add_sink</span><span class="p">()</span>
    <span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="n">num_threads</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
<div style="width: 360px"><div class="mermaid">
            flowchart TB
    subgraph Download
      direction TB
      t11[Task 1]
      t12[Task 2]
      t13[...]
      t1n[Task 12]
    end
    subgraph Preprocessing
      direction TB
      t21[Task 1]
      t22[Task 2]
      t23[...]
      t2n[12]
    end

    Source
     --&gt; Aggregate1[&quot;Aggregate (8)&quot;]
     --&gt; Download
     --&gt; Disaggregate
     --&gt; Preprocessing
     --&gt; Aggregate2[&quot;Aggregate(4)&quot;]
     --&gt; Collate
     --&gt; transfer[GPU Transfer]
     --&gt; Sink
        </div></div><section id="taskperfstats">
<h2>TaskPerfStats<a class="headerlink" href="#taskperfstats" title="Link to this heading">¶</a></h2>
<p>The <a class="reference internal" href="../generated/spdl.pipeline.TaskPerfStats.html#spdl.pipeline.TaskPerfStats" title="spdl.pipeline.TaskPerfStats"><code class="xref py py-class docutils literal notranslate"><span class="pre">TaskPerfStats</span></code></a> class contains information about the stage functions.</p>
<p>The statistics are aggregated (averaged or summed) over the (possibly concurrent)
invocations within the measurement window.</p>
<section id="average-time">
<h3>Average Time<a class="headerlink" href="#average-time" title="Link to this heading">¶</a></h3>
<p>The <a class="reference internal" href="../generated/spdl.pipeline.TaskPerfStats.html#spdl.pipeline.TaskPerfStats.ave_time" title="spdl.pipeline.TaskPerfStats.ave_time"><code class="xref py py-attr docutils literal notranslate"><span class="pre">TaskPerfStats.ave_time</span></code></a> represents the average time of successful function
invocations. Typically, download time is the largest, followed by decoding/preprocessing,
collation, and transfer.</p>
<p>When decoding is lightweight but the data size is large (such as processing long audio
in WAV format), collation and transfer can take longer than preprocessing.</p>
<p>In the following, we can see that the duration for downloading data changes over the course
of training. We also see occasional spikes.
The performance of downloading is affected by both external factors (i.e. the state of
networking) and internal factors (such as the size of data requested).
As we will see later, the speed of download is fast enough for this case, so the overall
change is not an issue here.</p>
<p>Other stages show the consistent performance throughout the training.</p>
<div id='perf_analysis_ave_time'></div></section>
<section id="the-number-of-tasks-executed">
<h3>The number of tasks executed<a class="headerlink" href="#the-number-of-tasks-executed" title="Link to this heading">¶</a></h3>
<p>The <a class="reference internal" href="../generated/spdl.pipeline.TaskPerfStats.html#spdl.pipeline.TaskPerfStats.num_tasks" title="spdl.pipeline.TaskPerfStats.num_tasks"><code class="xref py py-attr docutils literal notranslate"><span class="pre">TaskPerfStats.num_tasks</span></code></a> represents the number of function invocation
completed, including both successful and failure completion.
You can obtain the number of successful task counts, by subtracting
<a class="reference internal" href="../generated/spdl.pipeline.TaskPerfStats.html#spdl.pipeline.TaskPerfStats.num_failures" title="spdl.pipeline.TaskPerfStats.num_failures"><code class="xref py py-attr docutils literal notranslate"><span class="pre">TaskPerfStats.num_failures</span></code></a> from <code class="docutils literal notranslate"><span class="pre">TaskPerfStats.num_tasks</span></code>.
In this case, there was no failure during the training, so we omit the plot for that.</p>
<div id='perf_analysis_num_tasks'></div></section>
</section>
<section id="queueperfstats">
<h2>QueuePerfStats<a class="headerlink" href="#queueperfstats" title="Link to this heading">¶</a></h2>
<p>When a pipeline is built, queues are inserted between each stage.
The outputs from stage functions are put in their corresponding queues.
The inputs to the stage functions are retrieved from queues upstream to them.</p>
<p>The following figure illustrates this.
Using queues makes it easy to generalize the architecture of the pipeline,
as it allows for the independent orchestration of stage functions.</p>
<div style="width: 420px"><div class="mermaid">
            flowchart LR
     Queue
     subgraph S1[Stage 1]
         direction LR
         T11[Task 1]
         T12[Task 2]
         T13[Task 3]
         T14[Task ...]
     end
     Queue[Queue 1]
     subgraph S2[Stage 2]
         direction LR
         T21[Task 1]
         T22[Task 2]
         T23[Task ...]
     end
     Queue2[Queue 2]

     T11 -- Put --&gt; Queue
     T12 -- Put --&gt; Queue
     T13 -- Put --&gt; Queue
     T14 -- Put --&gt; Queue
     Queue ~~~ T21 -- Get --&gt; Queue
     Queue ~~~ T22 -- Get --&gt; Queue
     Queue ~~~ T23 -- Get --&gt; Queue
     T21 -- Put --&gt; Queue2
     T22 -- Put --&gt; Queue2
     T23 -- Put --&gt; Queue2
        </div></div><div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>In the following plots, a legned <code class="docutils literal notranslate"><span class="pre">&lt;STAGE&gt;</span></code> indicates that it is referring
to the performance of the queue attached at the exit of the <code class="docutils literal notranslate"><span class="pre">&lt;STAGE&gt;</span></code>.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">sink</span></code> queue is the last queue of the pipeline and it is consumed by
the foreground (the training loop).</p></li>
</ul>
</div>
<section id="throughput">
<h3>Throughput<a class="headerlink" href="#throughput" title="Link to this heading">¶</a></h3>
<p>Each queue has a fixed-size buffer. So the buffer also serves as
a regulator of back pressure.
For this reason, the throughput is roughly same across stages.
The <a class="reference internal" href="../generated/spdl.pipeline.QueuePerfStats.html#spdl.pipeline.QueuePerfStats.qps" title="spdl.pipeline.QueuePerfStats.qps"><code class="xref py py-attr docutils literal notranslate"><span class="pre">QueuePerfStats.qps</span></code></a> represents the number of items that
went through the queue (fetched by the downstream stage) per second.</p>
<p>Note that due to the operations <code class="docutils literal notranslate"><span class="pre">aggregate</span></code> and <code class="docutils literal notranslate"><span class="pre">disaggregate</span></code>,
the QPS values from different stages may live in different value
range, but they should match if normalized.</p>
<div id='perf_analysis_qps'></div></section>
<section id="data-readiness">
<h3>Data Readiness<a class="headerlink" href="#data-readiness" title="Link to this heading">¶</a></h3>
<p>The goal of performance analysis is to simplify the identification
of performance bottlenecks.
Due to the concurrency and elastic nature of the pipeline,
this task is not as straightforward as we want it to be.</p>
<p>The “Data Readiness” is our latest attempt in finding the bottleneck.
It measures the relative time that a queue has the next data available.</p>
<p>We define the data readiness as follow</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>data_readiness := 1 - d_empty / d_measure
</pre></div>
</div>
<p>where <code class="docutils literal notranslate"><span class="pre">d_measure</span></code> is the duration of the measurement (or elapsed time),
<code class="docutils literal notranslate"><span class="pre">d_empty</span></code> is the duration the queue was empty during the measurement.</p>
<div id='perf_analysis_data_readiness'></div><p>Data readiness close to 100% means that data is available whenever
the downstream stage (including the foreground training loop) tries to
fetch the next data, indicating that the data processing pipeline is
faster than the demand.</p>
<p>On the other hand, the data readiness close to 0% suggests that downstream
stages are starving. They fetch the next data as soon as it is available,
but the upstream is not able to fill it quick enough, indicating that the
data processing pipeline is not fast enough, and the system is
experiencing data starvation.</p>
<p>The following plot shows the data readiness of the same training run we observed.
From the source to up to the collate, the data readiness are close or above 99%.
But at GPU transfer, it drops to 85% and the sink readiness follows.</p>
<div id='perf_analysis_occupancy_rate'></div><p>Note that the value of data readiness is meaningful only in the context of
stages before and after the queue. It is not valid to compare the readiness of
different queues.</p>
<p>The drop at preprocess means that the downstream stage (aggregate) is consuming
the results faster than the rate of production.</p>
<p>The recovery of the data readiness in collate means that the rate at which
the downstream stage (gpu_transfer) is consuming the result is not as fast
as the rate of production.</p>
<p>The data readiness of the sink slightly recovers.
This suggests that the rate at which the foreground training loop consume the
data are slightly slower than the rate of transfer.</p>
</section>
<section id="queue-get-put-time">
<h3>Queue Get/Put Time<a class="headerlink" href="#queue-get-put-time" title="Link to this heading">¶</a></h3>
<p>Other stats related to data readiness are the time stage functions wait for the
completion of queue get and put operations.</p>
<p>If data is always available (i.e. data readiness is close to 100%), then stages
won’t be blocked when fetching the next data to process.
Therefore, the wait time for getting the next data is minimal.</p>
<p>Conversely, if the upstream is not producing data fast enough, the
downstream stages will be blocked while fetching the next data.</p>
<div id='perf_analysis_queue_get'></div><p>The time for put operation exhibits opposite trend.</p>
<p>If the data readiness is close to 100%, queues are full, and stage functions
cannot put the next result, so they must wait until a spot becomes available.
As a result, the wait time increases.
The wait time increases with higher concurrency, as multiple function invocations
attempt to put results into the queue.</p>
<p>If the production rate is slow, downstream stages wait for the next items.
Consequently, items placed in the queue are fetched immediately,
resulting in a less occupied queue.
This leads to the situation where the put time becomes close to zero.</p>
<p>The following plot shows that download and collate stages wait longer because
it is faster than the rate of the consumption of their downstreams
(preprocess and gpu_transfer).</p>
<div id='perf_analysis_queue_put'></div></section>
</section>
<section id="summary">
<h2>Summary<a class="headerlink" href="#summary" title="Link to this heading">¶</a></h2>
<p>SPDL Pipeline exposes performance statistics which help identifying the
performance bottleneck.</p>
<p>The most important metrics is the queue get time of sink stage, because the
wait time directly translates to the time the foreground training loop
waits for.</p>
<script src='https://cdn.plot.ly/plotly-2.34.0.min.js'></script>
<script>
 function plot(div_id, t, series, title, ylabel, N=1000) {
    var plot_data = [];
    for (const key of Object.keys(series).sort()) {
        plot_data.push({
            x: t,
            y: series[key],
            name: key,
            line: {
                size: 0.1,
            },
            visible: key.includes('aggregate') ? 'legendonly': null,
        });
    }
    Plotly.newPlot(
        div_id, {
            data: plot_data,
            layout: {
                title: title,
                yaxis: {
                    title: {
                        text: ylabel,
                    },
                    range: [0, null],
                },
                showlegend: true,
            },
        },
    );
 };

 document.addEventListener(
     'DOMContentLoaded',
     function() {
         const data_url = '../_static/data/pipeline_performance_analysis.json';
         const config = [
             {
                 div_id: 'perf_analysis_ave_time',
                 suffix: '_ave_time',
                 title: 'Task Execution Time',
                 ylabel: 'Time [sec]',
             },
             {
                 div_id: 'perf_analysis_num_tasks',
                 suffix: '_num_tasks',
                 title: 'Task Invocation',
                 ylabel: 'The number of invocations [/min]'
             },
             {
                 div_id: 'perf_analysis_qps',
                 suffix: '_qps',
                 title: 'Throughput',
                 ylabel: 'The number of items processed [/sec]'
             },
             {
                 div_id: 'perf_analysis_occupancy_rate',
                 suffix: '_queue_occupancy_rate',
                 title: 'Data Readiness',
                 ylabel: 'Data Readiness [%]'
             },
             {
                 div_id: 'perf_analysis_queue_get',
                 suffix: '_queue_get',
                 title: 'Average wait time to fetch the next result',
                 ylabel: 'Queue::Get wait time [sec]',
             },
             {
                 div_id: 'perf_analysis_queue_put',
                 suffix: '_queue_put',
                 title: 'Average wait time to put the result',
                 ylabel: 'Queue::Put wait time [sec]',
             },
         ];
         fetch(data_url)
             .then(response => {
                 if (!response.ok) {
                     throw new Error('Failed to fetch the data.');
                 }
                 return response.json();
             })
             .then(data=> {
                 const t = data['event_time'].map(v => { return new Date(v*1000); });
                 config.forEach(c => {
                     try {
                         const series = {};
                         for (const key in data) {
                             if (key.endsWith(c.suffix)) {
                                 let value = data[key];
                                 if (key.endsWith("_rate")) {
                                 value = value.map(v => { return v*100; });
                                 }
                                 const k = key.slice(0, key.length - c.suffix.length);
                                 series[k] = value;
                             }
                         }
                         plot(c.div_id, t, series, c.title, c.ylabel);
                     } catch(error) {
                         const div = document.getElementById(c.div_id);
                         div.textContent = "Failed to plot: " + error.toString();
                     }
                 });
             })
             .catch(error => {console.error(error);});


     },
     false);

 function plot_readiness_diagram(div_id) {
     var data = [
         {
             x: [0, 1, 1, 3, 3, 4, 4, 5, 5, 7, 7, 8, 8, 10],
             y: [2, 2, 3, 3, 2, 2, 3, 3, 2, 2, 3, 3, 2, 2],
             mode: 'lines',
             type: 'scatter',
         },
     ];
     var layout = {
         showlegend: false,
         yaxis: {
             tickvals: [2, 3],
             ticktext: ['Empty', 'Non-Empty'],
             range: [1.3, 3.8],
         },
         xaxis: {
             title: {text: 'Time'},
             tickvals: [],
         },
         annotations: [
             {
                 x: 3,
                 y: 3.2,
                 ax: 1.5,
                 ay: 3.2,
                 xref: 'x',
                 yref: 'y',
                 axref: 'x',
                 ayref: 'y',
                 text: '',
                 showarrow: true,
                 arrowhead: 3,
                 arrowsize: 1,
                 arrowwidth: 2,
                 arrowcolor: 'orange',
             },
             {
                 x: 1,
                 y: 3.2,
                 ax: 2.5,
                 ay: 3.2,
                 xref: 'x',
                 yref: 'y',
                 axref: 'x',
                 ayref: 'y',
                 text: '',
                 showarrow: true,
                 arrowhead: 3,
                 arrowsize: 1,
                 arrowwidth: 2,
                 arrowcolor: 'orange',
             },
             {
                 x: 5,
                 y: 3.2,
                 ax: 4.4,
                 ay: 3.2,
                 xref: 'x',
                 yref: 'y',
                 axref: 'x',
                 ayref: 'y',
                 text: '',
                 showarrow: true,
                 arrowhead: 3,
                 arrowsize: 1,
                 arrowwidth: 2,
                 arrowcolor: 'orange',
             },
             {
                 x: 4,
                 y: 3.2,
                 ax: 4.6,
                 ay: 3.2,
                 xref: 'x',
                 yref: 'y',
                 axref: 'x',
                 ayref: 'y',
                 text: '',
                 showarrow: true,
                 arrowhead: 3,
                 arrowsize: 1,
                 arrowwidth: 2,
                 arrowcolor: 'orange',
             },
             {
                 x: 8,
                 y: 3.2,
                 ax: 7.3,
                 ay: 3.2,
                 xref: 'x',
                 yref: 'y',
                 axref: 'x',
                 ayref: 'y',
                 text: '',
                 showarrow: true,
                 arrowhead: 3,
                 arrowsize: 1,
                 arrowwidth: 2,
                 arrowcolor: 'orange',
             },
             {
                 x: 7,
                 y: 3.2,
                 ax: 7.6,
                 ay: 3.2,
                 xref: 'x',
                 yref: 'y',
                 axref: 'x',
                 ayref: 'y',
                 text: '',
                 showarrow: true,
                 arrowhead: 3,
                 arrowsize: 1,
                 arrowwidth: 2,
                 arrowcolor: 'orange',
             },
             {
                 x: 2,
                 y: 3.55,
                 xref: 'x',
                 yref: 'y',
                 text: 'The duration the queue is not empty',
                 font: {color: 'orange'},
                 showarrow: false,
             },
             {
                 x: 5,
                 y: 1.5,
                 xref: 'x',
                 yref: 'y',
                 text: 'The duration of the measurement.',
                 font: {color: 'black'},
                 showarrow: false,
             },
             {
                 x: 0,
                 y: 1.8,
                 ax:6,
                 ay: 1.8,
                 xref: 'x',
                 yref: 'y',
                 axref: 'x',
                 ayref: 'y',
                 text: '',
                 showarrow: true,
                 arrowhead: 3,
                 arrowsize: 1,
                 arrowwidth: 2,
                 arrowcolor: 'black',
             },
             {
                 x: 10,
                 y: 1.8,
                 ax: 4,
                 ay: 1.8,
                 xref: 'x',
                 yref: 'y',
                 axref: 'x',
                 ayref: 'y',
                 text: '',
                 showarrow: true,
                 arrowhead: 3,
                 arrowsize: 1,
                 arrowwidth: 2,
                 arrowcolor: 'black',
             }
         ],
     };
     config = {
         displayModeBar: false,
     };
     Plotly.newPlot(div_id, data, layout, config);
 };
 document.addEventListener(
     'DOMContentLoaded',
     function() {
         plot_readiness_diagram('perf_analysis_data_readiness');
     },
     false);
</script></section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="fleet_metrics.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Metrics across Ranks</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="setup.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Composition of Pipeline</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2025, Meta Platforms, Inc.
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Analyzing the Performance</a><ul>
<li><a class="reference internal" href="#taskperfstats">TaskPerfStats</a><ul>
<li><a class="reference internal" href="#average-time">Average Time</a></li>
<li><a class="reference internal" href="#the-number-of-tasks-executed">The number of tasks executed</a></li>
</ul>
</li>
<li><a class="reference internal" href="#queueperfstats">QueuePerfStats</a><ul>
<li><a class="reference internal" href="#throughput">Throughput</a></li>
<li><a class="reference internal" href="#data-readiness">Data Readiness</a></li>
<li><a class="reference internal" href="#queue-get-put-time">Queue Get/Put Time</a></li>
</ul>
</li>
<li><a class="reference internal" href="#summary">Summary</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div>
    <script src="../_static/js/custom.js"></script><script src="../_static/documentation_options.js?v=38b66d78"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/scripts/furo.js?v=5fa4622c"></script>
    <script src="../_static/collapsible-lists/js/CollapsibleLists.compressed.js?v=73120307"></script>
    <script src="../_static/collapsible-lists/js/apply-collapsible-lists.js?v=660e4f45"></script>
    <script src="https://unpkg.com/mermaid@11.4.1/dist/mermaid.min.js"></script>
    <script>mermaid.initialize({startOnLoad:true});</script>
    </body>
</html>